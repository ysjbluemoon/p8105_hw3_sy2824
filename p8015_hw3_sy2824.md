p8105\_hw3\_sy2824
================
Sijia Yue
2018-10-06

Question 1
==========

Cleaning data
-------------

``` r
tidy_brfss = brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health") %>% 
  select(-class, -topic, -question, -sample_size, -(confidence_limit_low:geo_location))  %>% 
  mutate(response = forcats::fct_relevel(response,c("Excellent", "Very good", "Good", "Fair", "Poor")))
```

Questions
---------

**In 2002, which states were observed at 7 locations?**

``` r
filter(tidy_brfss, year == "2002") %>% 
  group_by(locationabbr) %>% 
  summarize(n_location = n_distinct(locationdesc)) %>% 
  filter(n_location == "7") 
```

    ## # A tibble: 3 x 2
    ##   locationabbr n_location
    ##   <chr>             <int>
    ## 1 CT                    7
    ## 2 FL                    7
    ## 3 NC                    7

In 2002, the states that were observed at 7 locations are `CT`, `FL` and `NC`.

**Make a “spaghetti plot” that shows the number of observations in each state from 2002 to 2010.**

``` r
  group_by(tidy_brfss,locationabbr,year) %>% 
  summarize(n_location = n_distinct(locationdesc)) %>% 
  ggplot(aes(y = n_location, x = year)) +
  geom_line(aes(color = locationabbr), alpha = .5) +
  labs(
    title = "Spaghetti plot",
    x = "Year",
    y = "Number of observations in each state"
  ) 
```

<img src="p8015_hw3_sy2824_files/figure-markdown_github/unnamed-chunk-3-1.png" width="90%" />

**Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.**

``` r
filter(tidy_brfss, year == "2002" | year == "2006" | year == "2010") %>% 
  filter(locationabbr == "NY") %>% 
  filter(response == "Excellent") %>% 
  spread(key = response, value = data_value) %>% 
  janitor::clean_names() %>% 
  group_by(year) %>% 
  summarize(
    mean_proportion = mean(excellent),
    sd_proportion = sd(excellent)
    ) 
```

    ## # A tibble: 3 x 3
    ##    year mean_proportion sd_proportion
    ##   <int>           <dbl>         <dbl>
    ## 1  2002            24.0          4.49
    ## 2  2006            22.5          4.00
    ## 3  2010            22.7          3.57

**For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.**

``` r
  group_by(tidy_brfss, year, locationabbr,response) %>% 
  summarize(mean = mean(data_value, na.rm = TRUE)) %>% 
  
  ggplot(aes(x = year, y = mean, color = response)) +
  geom_point() +
  facet_grid(.~response) +
    labs(
      title = "Average proportion in each response category",
      x = "Year",
      y = "Mean value of proportion for each response"
    ) +
  theme(legend.position = "bottom")
```

<img src="p8015_hw3_sy2824_files/figure-markdown_github/unnamed-chunk-5-1.png" width="90%" />

Question 2
==========

Cleaning data
-------------

``` r
cart_data = instacart
```

There are 1384617 rows and 15 coloums.

**How many aisles are there, and which aisles are the most items ordered from?**

``` r
distinct(cart_data, aisle_id) %>% 
  count()
```

    ## # A tibble: 1 x 1
    ##       n
    ##   <int>
    ## 1   134

``` r
cart_data %>% 
  group_by(aisle) %>% 
  summarize(number = n()) %>% 
  arrange(desc(number))
```

    ## # A tibble: 134 x 2
    ##    aisle                         number
    ##    <chr>                          <int>
    ##  1 fresh vegetables              150609
    ##  2 fresh fruits                  150473
    ##  3 packaged vegetables fruits     78493
    ##  4 yogurt                         55240
    ##  5 packaged cheese                41699
    ##  6 water seltzer sparkling water  36617
    ##  7 milk                           32644
    ##  8 chips pretzels                 31269
    ##  9 soy lactosefree                26240
    ## 10 bread                          23635
    ## # ... with 124 more rows

There are 134 aisles. The most items ordered from is `fresh vegetables` and the second popular order item is `fresh fruits`.

**Make a plot that shows the number of items ordered in each aisle. Order aisles sensibly, and organize your plot so others can read it.**

``` r
cart_data %>% 
  group_by(aisle) %>% 
  summarize(number = n()) %>% 
  arrange(desc(number)) %>% 
  ggplot(aes(x = aisle, y = number)) +
  geom_point() +
  labs(
      title = "Number of items ordered in each aisle",
      x = "Items",
      y = "Number of items"
    ) +
  theme(legend.position = "bottom",axis.text.x = element_text(angle = 270, hjust = 0))
```

<img src="p8015_hw3_sy2824_files/figure-markdown_github/unnamed-chunk-8-1.png" width="90%" />

**Make a table showing the most popular item aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”.**

``` r
popular_items = filter(cart_data, aisle %in% c('baking ingredients', 'dog food care', 'packaged vegetables fruits')) %>% 
group_by(aisle, product_name) %>% 
  summarize(number = n()) 

 top_baking_ingredients = filter(popular_items, aisle == "baking ingredients") %>% 
  arrange(desc(number)) %>%
    head(3) 
 
  top_dog_food_care = filter(popular_items, aisle == "dog food care") %>% 
    arrange(desc(number)) %>% 
    head(3)
  
  top_packaged_vegetables_fruits = filter(popular_items, aisle == "packaged vegetables fruits") %>% 
    arrange(desc(number)) %>% 
    head(3)
  
 popular_items = bind_rows(top_baking_ingredients,top_dog_food_care,top_packaged_vegetables_fruits)
```

**Make a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week; format this table for human readers (i.e. produce a 2 x 7 table)**

``` r
mutate(cart_data, order_dow = factor(order_dow, labels  = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))) %>% 
filter(product_name %in% c("Pink Lady Apples","Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>%
  summarize(mean_hour = mean(order_hour_of_day)) %>% 
  spread(key = order_dow, value = mean_hour)
```

    ## # A tibble: 2 x 8
    ## # Groups:   product_name [2]
    ##   product_name     Sunday Monday Tuesday Wednesday Thursday Friday Saturday
    ##   <chr>             <dbl>  <dbl>   <dbl>     <dbl>    <dbl>  <dbl>    <dbl>
    ## 1 Coffee Ice Cream   13.8   14.3    15.4      15.3     15.2   12.3     13.8
    ## 2 Pink Lady Apples   13.4   11.4    11.7      14.2     11.6   12.8     11.9
